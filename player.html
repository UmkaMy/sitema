<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Light Fox Manga - –ü–ª–µ–µ—Ä</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-color: #f5f5f5;
            --card-bg: #ffffff;
            --text-color: #333;
            --border-color: #e0e0e0;
            --primary-color: #ff8a50;
            --primary-hover: #ff7043;
            --secondary-color: #666;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
            --header-height: 60px;
        }

        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --card-bg: #2d2d2d;
            --text-color: #ffffff;
            --border-color: #444;
            --secondary-color: #aaa;
            --shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            padding: 0 32px;
            z-index: 1000;
            box-shadow: var(--shadow);
        }

        .back-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s;
            margin-right: auto;
        }

        .back-button:hover {
            border-color: var(--primary-color);
            background-color: rgba(255, 138, 80, 0.05);
        }

        .header-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-color);
            flex: 1;
            text-align: center;
            margin: 0 20px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .theme-toggle {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--card-bg);
            color: var(--text-color);
            cursor: pointer;
            font-size: 16px;
            width: 40px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle svg {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        /* Main Content */
        .main-content {
            margin-top: var(--header-height);
            min-height: calc(100vh - var(--header-height));
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Loading & Error States */
        .loading-container, .error-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            text-align: center;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-icon {
            font-size: 4rem;
            color: #dc3545;
            margin-bottom: 20px;
        }

        /* Player Layout */
        .player-layout {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        @media (min-width: 1024px) {
            .player-layout {
                grid-template-columns: 1fr 400px;
            }
        }

        /* Video Player */
        .video-container {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .video-wrapper {
            position: relative;
            aspect-ratio: 16/9;
            background: #000;
        }

        .video-player {
            width: 100%;
            height: 100%;
            border: none;
        }

        .video-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: white;
            flex-direction: column;
            gap: 16px;
        }

        .play-icon {
            font-size: 4rem;
            color: var(--primary-color);
        }

        /* Player Controls */
        .player-controls {
            padding: 20px;
        }

        .manga-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 8px;
        }

        .episode-info {
            font-size: 1rem;
            color: var(--secondary-color);
            margin-bottom: 20px;
        }

        .episode-unavailable {
            color: #dc3545;
            font-weight: 500;
        }

        /* Episode Selector */
        .episode-selector {
            margin-bottom: 20px;
        }

        .episode-selector h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 12px;
        }

        .episode-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
            padding: 8px;
            background: var(--bg-color);
            border-radius: 8px;
        }

        .episode-button {
            padding: 10px 8px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--card-bg);
            color: var(--text-color);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            position: relative;
        }

        .episode-button:hover {
            border-color: var(--primary-color);
            background-color: rgba(255, 138, 80, 0.05);
        }

        .episode-button.current {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .episode-button.unavailable {
            background: #f8f9fa;
            color: #6c757d;
            border-color: #dee2e6;
            position: relative;
            cursor: pointer;
        }

        .episode-button.unavailable:hover {
            border-color: #dc3545;
            background-color: rgba(220, 53, 69, 0.05);
        }

        .episode-button.unavailable::after {
            content: 'üîí';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 10px;
        }

        /* Action Buttons */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 12px 8px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--card-bg);
            color: var(--text-color);
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 500;
            transition: all 0.2s;
            text-decoration: none;
            min-height: 60px;
            gap: 4px;
        }

        .action-btn:hover {
            border-color: var(--primary-color);
            background-color: rgba(255, 138, 80, 0.05);
            transform: translateY(-1px);
        }

        .action-btn.primary {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .action-btn.primary:hover {
            background: var(--primary-hover);
        }

        .action-btn i {
            font-size: 1.2rem;
        }

        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Manga Info */
        .manga-info {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .manga-poster {
            width: 100%;
            aspect-ratio: 3/4;
            border-radius: 8px;
            object-fit: cover;
            margin-bottom: 16px;
        }

        .manga-details {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 500;
            color: var(--secondary-color);
        }

        .detail-value {
            font-weight: 600;
            color: var(--text-color);
        }

        .rating-value {
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .status-badge {
            background: var(--primary-color);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .manga-description {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        .manga-description h4 {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 8px;
        }

        .manga-description p {
            font-size: 0.875rem;
            color: var(--secondary-color);
            line-height: 1.5;
        }

        /* Donation Section */
        .donation-section {
            background: linear-gradient(135deg, rgba(255, 138, 80, 0.1) 0%, rgba(255, 112, 67, 0.1) 100%);
            border: 1px solid rgba(255, 138, 80, 0.2);
            border-radius: 12px;
            padding: 20px;
        }

        .donation-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .progress-container {
            margin-bottom: 16px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.875rem;
        }

        .progress-bar-container {
            width: 100%;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-hover));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .progress-percentage {
            text-align: center;
            font-weight: 600;
            color: var(--primary-color);
            margin-top: 8px;
        }

        .donation-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 12px;
            background: var(--card-bg);
            color: var(--text-color);
        }

        .donation-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 138, 80, 0.1);
        }

        .donation-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 12px;
        }

        .donation-quick-btn {
            padding: 8px 12px;
            border: 1px solid var(--primary-color);
            border-radius: 6px;
            background: transparent;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .donation-quick-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        .donate-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .donate-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 138, 80, 0.3);
        }

        .donate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header {
                padding: 0 16px;
            }

            .container {
                padding: 16px;
            }

            .manga-title {
                font-size: 1.25rem;
            }

            .action-buttons {
                grid-template-columns: repeat(2, 1fr);
            }

            .episode-grid {
                grid-template-columns: repeat(auto-fill, minmax(45px, 1fr));
                gap: 6px;
            }

            .episode-button {
                padding: 8px 6px;
                font-size: 0.8rem;
            }
        }

        /* Genres Tags */
        .genres-container {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 12px;
        }

        .genre-tag {
            background: var(--bg-color);
            color: var(--secondary-color);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            border: 1px solid var(--border-color);
        }
    </style>
</head>
<body data-theme="light">
    <!-- Header -->
    <header class="header">
        <a href="catalog.html" class="back-button">
            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            –ö–∞—Ç–∞–ª–æ–≥
        </a>
        
        <h1 class="header-title" id="headerTitle">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
        
        <button class="theme-toggle" id="themeToggle">
            <svg class="moon-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M21 12.79C20.8427 14.4922 20.2039 16.1144 19.1583 17.4668C18.1127 18.8192 16.7035 19.8458 15.0957 20.4265C13.4879 21.0073 11.7431 21.1181 10.0644 20.7461C8.38579 20.374 6.8398 19.5345 5.61677 18.3271C4.39374 17.1198 3.54362 15.5916 3.17133 13.9299C2.79905 12.2682 2.91262 10.5378 3.49644 8.94267C4.08026 7.34753 5.10962 5.94939 6.46482 4.90969C7.82002 3.86999 9.44343 3.23112 11.16 3.08C10.1598 4.98048 9.94059 7.18295 10.5446 9.23931C11.1486 11.2957 12.5154 13.0464 14.3735 14.1467C16.2317 15.247 18.4549 15.6021 20.55 15.13L21 12.79Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <svg class="sun-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: none;">
                <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 1V3M12 21V23M4.22 4.22L5.64 5.64M18.36 18.36L19.78 19.78M1 12H3M21 12H23M4.22 19.78L5.64 18.36M18.36 5.64L19.78 4.22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Loading State -->
            <div class="loading-container" id="loadingState">
                <div class="spinner"></div>
                <h3>–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∞–π—Ç–ª–∞...</h3>
                <p>–ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –ø–ª–µ–µ—Ä –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</p>
            </div>

            <!-- Error State -->
            <div class="error-container" id="errorState" style="display: none;">
                <div class="error-icon">‚ùå</div>
                <h3>–¢–∞–π—Ç–ª –Ω–µ –Ω–∞–π–¥–µ–Ω</h3>
                <p>–í–æ–∑–º–æ–∂–Ω–æ, —Ç–∞–π—Ç–ª –±—ã–ª —É–¥–∞–ª–µ–Ω –∏–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</p>
                <a href="catalog.html" class="action-btn primary" style="margin-top: 20px;">
                    <i>üìö</i>
                    –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥
                </a>
            </div>

            <!-- Player Content -->
            <div class="player-layout" id="playerContent" style="display: none;">
                <!-- Video Player -->
                <div class="video-container">
                    <div class="video-wrapper">
                        <iframe id="videoPlayer" class="video-player" style="display: none;"></iframe>
                        <div class="video-placeholder" id="videoPlaceholder">
                            <div class="play-icon">‚ñ∂Ô∏è</div>
                            <h3 id="placeholderTitle">–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ä–∏—é</h3>
                            <p id="placeholderText">–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ä–∏—é –∏–∑ —Å–ø–∏—Å–∫–∞ –Ω–∏–∂–µ –¥–ª—è –Ω–∞—á–∞–ª–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</p>
                        </div>
                    </div>

                    <div class="player-controls">
                        <h2 class="manga-title" id="mangaTitle"></h2>
                        <p class="episode-info" id="episodeInfo"></p>

                        <!-- Episode Selector -->
                        <div class="episode-selector">
                            <h3>–í—ã–±–æ—Ä —Å–µ—Ä–∏–∏</h3>
                            <div class="episode-grid" id="episodeGrid">
                                <!-- Episodes will be generated by JavaScript -->
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="action-buttons">
                            <button class="action-btn" onclick="addToFavorites()">
                                <i>‚ù§Ô∏è</i>
                                –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
                            </button>
                            <button class="action-btn" onclick="addToWatching()">
                                <i>‚ñ∂Ô∏è</i>
                                –°–º–æ—Ç—Ä—é
                            </button>
                            <button class="action-btn" onclick="addToWantToWatch()">
                                <i>üìö</i>
                                –•–æ—á—É
                            </button>
                            <button class="action-btn" onclick="addToCompleted()">
                                <i>‚úÖ</i>
                                –î–æ—Å–º–æ—Ç—Ä–µ–ª
                            </button>
                            <button class="action-btn" onclick="markCurrentEpisode()">
                                <i>‚è∏Ô∏è</i>
                                –û—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è
                            </button>
                            <button class="action-btn primary" onclick="openInCabinet()">
                                <i>üë§</i>
                                –í –∫–∞–±–∏–Ω–µ—Ç
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="sidebar">
                    <!-- Manga Info -->
                    <div class="manga-info">
                        <img id="mangaPoster" class="manga-poster" alt="–û–±–ª–æ–∂–∫–∞">
                        
                        <div class="manga-details">
                            <div class="detail-row">
                                <span class="detail-label">–°—Ç–∞—Ç—É—Å:</span>
                                <span class="detail-value">
                                    <span class="status-badge" id="mangaStatus"></span>
                                </span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">–°–µ—Ä–∏–π:</span>
                                <span class="detail-value" id="episodeCount"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">–¢–∏–ø:</span>
                                <span class="detail-value" id="mangaType"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">–ì–æ–¥:</span>
                                <span class="detail-value" id="mangaYear"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">–†–µ–π—Ç–∏–Ω–≥:</span>
                                <span class="detail-value rating-value" id="mangaRating">
                                    <span>‚≠ê</span>
                                    <span></span>
                                </span>
                            </div>
                        </div>

                        <div class="genres-container" id="genresContainer">
                            <!-- Genres will be generated by JavaScript -->
                        </div>

                        <div class="manga-description" id="descriptionContainer" style="display: none;">
                            <h4>–û–ø–∏—Å–∞–Ω–∏–µ</h4>
                            <p id="mangaDescription"></p>
                        </div>
                    </div>

                    <!-- Donation Section -->
                    <div class="donation-section">
                        <h3 class="donation-title">
                            <span>üöÄ</span>
                            –£—Å–∫–æ—Ä–∏—Ç—å –≤—ã—Ö–æ–¥ —Ç–∞–π—Ç–ª–∞
                        </h3>
                        
                        <div class="progress-container">
                            <div class="progress-info">
                                <span>–°–æ–±—Ä–∞–Ω–æ: <span id="currentDonations">0</span>‚ÇΩ</span>
                                <span>–¶–µ–ª—å: <span id="donationGoal">10,000</span>‚ÇΩ</span>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar-fill" id="progressBarFill" style="width: 0%"></div>
                            </div>
                            <div class="progress-percentage" id="progressPercentage">0%</div>
                        </div>

                        <input type="number" class="donation-input" id="donationAmount" 
                               placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –æ—Ç 10‚ÇΩ" min="10" max="50000">
                        
                        <div class="donation-buttons">
                            <button class="donation-quick-btn" onclick="setDonationAmount(100)">100‚ÇΩ</button>
                            <button class="donation-quick-btn" onclick="setDonationAmount(500)">500‚ÇΩ</button>
                            <button class="donation-quick-btn" onclick="setDonationAmount(1000)">1000‚ÇΩ</button>
                            <button class="donation-quick-btn" onclick="setDonationAmount(2000)">2000‚ÇΩ</button>
                        </div>

                        <button class="donate-btn" id="donateBtn" onclick="makeDonation()">
                            üíù –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- Scripts -->
    <script>
        // –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∏—Å—Ç–µ–º—É –¥–∞–Ω–Ω—ã—Ö
        const script = document.createElement('script');
        script.src = 'js/data.js';
        document.head.appendChild(script);
    </script>
    
    <script>
        // State
        let currentManga = null;
        let currentEpisode = 1;
        let isDark = localStorage.getItem('theme') === 'dark';

        // Theme functionality
        function updateTheme() {
            document.body.setAttribute('data-theme', isDark ? 'dark' : 'light');
            
            const moonIcon = document.querySelector('.moon-icon');
            const sunIcon = document.querySelector('.sun-icon');
            if (isDark) {
                moonIcon.style.display = 'none';
                sunIcon.style.display = 'block';
            } else {
                moonIcon.style.display = 'block';
                sunIcon.style.display = 'none';
            }
            
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        function toggleTheme() {
            isDark = !isDark;
            updateTheme();
        }

        // Get manga ID from URL
        function getMangaIdFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        // Initialize player
        function initializePlayer() {
            const mangaId = getMangaIdFromURL();
            
            if (!mangaId) {
                showError('ID —Ç–∞–π—Ç–ª–∞ –Ω–µ —É–∫–∞–∑–∞–Ω –≤ URL');
                return;
            }

            if (!window.MangaAPI) {
                showError('–°–∏—Å—Ç–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                return;
            }

            currentManga = window.MangaAPI.getMangaById(mangaId);
            
            if (!currentManga) {
                showError(`–¢–∞–π—Ç–ª —Å ID ${mangaId} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
                return;
            }

            loadMangaData();
        }

        // Load manga data
        function loadMangaData() {
            // Hide loading, show content
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('playerContent').style.display = 'block';

            // Update header
            document.getElementById('headerTitle').textContent = currentManga.title;

            // Update manga info
            document.getElementById('mangaTitle').textContent = currentManga.title;
            document.getElementById('mangaPoster').src = currentManga.image || 'https://via.placeholder.com/300x400/FF6B35/FFFFFF?text=' + encodeURIComponent(currentManga.title);
            document.getElementById('mangaStatus').textContent = currentManga.status || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            document.getElementById('episodeCount').textContent = `${currentManga.availableEpisodes}/${currentManga.totalEpisodes}`;
            document.getElementById('mangaType').textContent = currentManga.type || '–ú–∞–Ω–≥–∞';
            document.getElementById('mangaYear').textContent = currentManga.year || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            document.getElementById('mangaRating').querySelector('span:last-child').textContent = currentManga.rating || 'N/A';

            // Update genres
            if (currentManga.genres && currentManga.genres.length > 0) {
                const genresContainer = document.getElementById('genresContainer');
                genresContainer.innerHTML = currentManga.genres.map(genre => 
                    `<span class="genre-tag">${genre}</span>`
                ).join('');
            }

            // Update description
            if (currentManga.description) {
                document.getElementById('descriptionContainer').style.display = 'block';
                document.getElementById('mangaDescription').textContent = currentManga.description;
            }

            // Update donation info
            updateDonationInfo();

            // Generate episode buttons
            generateEpisodeButtons();

            // Update episode info
            updateEpisodeInfo();
        }

        // Generate episode buttons
        function generateEpisodeButtons() {
            const grid = document.getElementById('episodeGrid');
            const episodes = [];

            for (let i = 1; i <= currentManga.totalEpisodes; i++) {
                const isAvailable = i <= currentManga.availableEpisodes;
                const isCurrent = i === currentEpisode;
                
                episodes.push(`
                    <button class="episode-button ${isCurrent ? 'current' : ''} ${!isAvailable ? 'unavailable' : ''}"
                            onclick="selectEpisode(${i})" data-episode="${i}">
                        ${i}
                    </button>
                `);
            }

            grid.innerHTML = episodes.join('');
        }

        // Select episode
        function selectEpisode(episode) {
            currentEpisode = episode;

            // Update current episode styling
            document.querySelectorAll('.episode-button').forEach(btn => {
                btn.classList.remove('current');
                if (parseInt(btn.dataset.episode) === episode) {
                    btn.classList.add('current');
                }
            });

            // Update episode info
            updateEpisodeInfo();

            // Load video if available
            loadVideo(episode);
        }

        // Update episode info
        function updateEpisodeInfo() {
            const info = document.getElementById('episodeInfo');
            const isAvailable = currentEpisode <= currentManga.availableEpisodes;
            
            if (isAvailable) {
                info.innerHTML = `–°–µ—Ä–∏—è ${currentEpisode} –∏–∑ ${currentManga.totalEpisodes}`;
                info.classList.remove('episode-unavailable');
            } else {
                info.innerHTML = `<span class="episode-unavailable">–°–µ—Ä–∏—è ${currentEpisode} –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</span>`;
                info.classList.add('episode-unavailable');
            }
        }

        // Load video
        function loadVideo(episode) {
            const player = document.getElementById('videoPlayer');
            const placeholder = document.getElementById('videoPlaceholder');
            const title = document.getElementById('placeholderTitle');
            const text = document.getElementById('placeholderText');
            const isAvailable = episode <= currentManga.availableEpisodes;
            const videoUrl = currentManga.episodes && currentManga.episodes[episode];

            if (isAvailable && videoUrl) {
                // Load video
                player.src = videoUrl;
                player.style.display = 'block';
                placeholder.style.display = 'none';
            } else if (!isAvailable) {
                // Show unavailable message
                player.style.display = 'none';
                placeholder.style.display = 'flex';
                title.textContent = `–°–µ—Ä–∏—è ${episode} –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞`;
                text.innerHTML = `–ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç, —á—Ç–æ–±—ã —É—Å–∫–æ—Ä–∏—Ç—å –≤—ã—Ö–æ–¥ –Ω–æ–≤—ã—Ö —Å–µ—Ä–∏–π!<br><strong>–¶–µ–ª—å: ${(currentManga.donationGoal || 10000).toLocaleString()}‚ÇΩ</strong>`;
            } else {
                // Video not found
                player.style.display = 'none';
                placeholder.style.display = 'flex';
                title.textContent = `–°–µ—Ä–∏—è ${episode}`;
                text.textContent = '–í–∏–¥–µ–æ –ø–æ–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ';
            }
        }

        // Update donation info
        function updateDonationInfo() {
            const current = currentManga.currentDonations || 0;
            const goal = currentManga.donationGoal || 10000;
            const percentage = (current / goal) * 100;

            document.getElementById('currentDonations').textContent = current.toLocaleString();
            document.getElementById('donationGoal').textContent = goal.toLocaleString();
            document.getElementById('progressBarFill').style.width = `${Math.min(percentage, 100)}%`;
            document.getElementById('progressPercentage').textContent = `${percentage.toFixed(1)}%`;

            // Update donate button
            const donateBtn = document.getElementById('donateBtn');
            if (percentage >= 100) {
                donateBtn.textContent = '‚úÖ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!';
                donateBtn.disabled = true;
            }
        }

        // Donation functions
        function setDonationAmount(amount) {
            document.getElementById('donationAmount').value = amount;
        }

        function makeDonation() {
            const amount = parseInt(document.getElementById('donationAmount').value) || 0;
            
            if (amount < 10) {
                showNotification('–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –¥–æ–Ω–∞—Ç–∞: 10‚ÇΩ', 'error');
                return;
            }

            if (amount > 50000) {
                showNotification('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –¥–æ–Ω–∞—Ç–∞: 50,000‚ÇΩ', 'error');
                return;
            }

            // Update donation amount
            const newTotal = Math.min((currentManga.currentDonations || 0) + amount, currentManga.donationGoal || 10000);
            
            // Update manga data
            if (window.MangaAPI) {
                window.MangaAPI.updateManga(currentManga.id, {
                    currentDonations: newTotal
                });
                currentManga.currentDonations = newTotal;
            }

            // Update UI
            updateDonationInfo();

            // Clear input
            document.getElementById('donationAmount').value = '';

            // Show notification
            showNotification(`–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É! –î–æ–±–∞–≤–ª–µ–Ω–æ ${amount.toLocaleString()}‚ÇΩ`, 'success');

            // Save to user's donation history
            const donationHistory = JSON.parse(localStorage.getItem('donationHistory') || '[]');
            donationHistory.push({
                mangaId: currentManga.id,
                mangaTitle: currentManga.title,
                amount: amount,
                episode: currentEpisode,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('donationHistory', JSON.stringify(donationHistory));
        }

        // User actions
        function addToFavorites() {
            addToUserList('favorites', '–ò–∑–±—Ä–∞–Ω–Ω–æ–µ');
        }

        function addToWatching() {
            addToUserList('watching', '–°–º–æ—Ç—Ä—é');
        }

        function addToWantToWatch() {
            addToUserList('wantToWatch', '–•–æ—á—É –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å');
        }

        function addToCompleted() {
            addToUserList('completed', '–î–æ—Å–º–æ—Ç—Ä–µ–ª');
        }

        function addToUserList(listName, listTitle) {
            const mangaForStorage = {
                id: Date.now(),
                mangaId: currentManga.id,
                title: currentManga.title,
                image: currentManga.image,
                currentEpisode: currentEpisode,
                totalEpisodes: currentManga.totalEpisodes,
                availableEpisodes: currentManga.availableEpisodes,
                status: currentManga.status,
                rating: currentManga.rating,
                addedAt: new Date().toISOString()
            };

            const currentList = JSON.parse(localStorage.getItem(listName) || '[]');
            
            // Remove if already exists
            const filtered = currentList.filter(item => item.mangaId !== currentManga.id);
            
            // Add new entry
            filtered.push(mangaForStorage);
            
            localStorage.setItem(listName, JSON.stringify(filtered));
            
            showNotification(`–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ "${listTitle}"`, 'success');
        }

        function markCurrentEpisode() {
            const watchingProgress = JSON.parse(localStorage.getItem('watchingProgress') || '{}');
            watchingProgress[currentManga.id] = {
                mangaTitle: currentManga.title,
                currentEpisode: currentEpisode,
                totalEpisodes: currentManga.totalEpisodes,
                lastWatched: new Date().toISOString()
            };
            localStorage.setItem('watchingProgress', JSON.stringify(watchingProgress));
            
            showNotification(`–û—Ç–º–µ—á–µ–Ω–æ: –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –Ω–∞ —Å–µ—Ä–∏–∏ ${currentEpisode}`, 'success');
        }

        function openInCabinet() {
            // Add to watching list first
            addToWatching();
            
            // Redirect to cabinet
            setTimeout(() => {
                window.location.href = 'cabinet.html';
            }, 1000);
        }

        // Utility functions
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification show ${type}`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function showError(message) {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('errorState').style.display = 'flex';
            
            const errorContainer = document.getElementById('errorState');
            errorContainer.querySelector('p').textContent = message;
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            
            // Initialize theme
            updateTheme();

            // If data is already loaded, initialize immediately
            if (window.MangaAPI) {
                initializePlayer();
            }
        });

        // Listen for data ready event
        window.addEventListener('mangaDataReady', initializePlayer);

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (!currentManga) return;

            switch(e.key) {
                case 'ArrowLeft':
                    if (currentEpisode > 1) {
                        selectEpisode(currentEpisode - 1);
                    }
                    break;
                case 'ArrowRight':
                    if (currentEpisode < currentManga.totalEpisodes) {
                        selectEpisode(currentEpisode + 1);
                    }
                    break;
                case 'Home':
                    selectEpisode(1);
                    break;
                case 'End':
                    selectEpisode(currentManga.availableEpisodes);
                    break;
            }
        });
    </script>
</body>
</html>
