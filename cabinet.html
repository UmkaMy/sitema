<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Light Fox Manga - Личный кабинет</title>
    <style>
        /* ТОЧНО ТАКИЕ ЖЕ СТИЛИ КАК В ОРИГИНАЛЕ */
        .desktop-nav a,
        .bottom-nav .nav-item {
            color: #000;
        }

        [data-theme="dark"] .desktop-nav a,
        [data-theme="dark"] .bottom-nav .nav-item {
            color: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-color: #f5f5f5;
            --card-bg: #ffffff;
            --text-color: #333;
            --border-color: #e0e0e0;
            --primary-color: #ff8a50;
            --primary-hover: #ff7043;
            --secondary-color: #666;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
            --header-height: 60px;
            --mobile-bottom-nav: 60px;
        }

        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --card-bg: #2d2d2d;
            --text-color: #ffffff;
            --border-color: #444;
            --secondary-color: #aaa;
            --shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding-bottom: var(--mobile-bottom-nav);
            min-height: 100vh;
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            display: none;
            align-items: center;
            padding: 0 32px;
            z-index: 1000;
            box-shadow: var(--shadow);
        }

        .logo {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary-color);
            margin-right: auto;
            cursor: pointer;
            text-decoration: none;
        }

        .logo:hover {
            color: var(--primary-hover);
        }

        .desktop-nav {
            display: flex;
            gap: 24px;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        .desktop-nav a {
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
        }

        .desktop-nav a.active {
            background: var(--primary-color);
            color: white;
        }

        .desktop-nav a:hover {
            background: var(--primary-hover);
            color: white;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .lang-switch, .theme-toggle {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--card-bg);
            color: var(--text-color);
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .theme-toggle {
            font-size: 16px;
            width: 40px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle svg,
        .mobile-theme-btn svg {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        .profile-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
            border: none;
        }

        .profile-btn:hover {
            background: var(--primary-hover);
            transform: scale(1.05);
        }

        .profile-btn svg {
            width: 16px;
            height: 16px;
            stroke: currentColor;
        }

        .main-content {
            margin-top: 0;
            padding: 20px 16px;
            min-height: 100vh;
        }

        @media (min-width: 768px) {
            body {
                padding-bottom: 0;
            }
            
            .header {
                display: flex;
            }
            
            .main-content {
                margin-top: var(--header-height);
            }
            
            .bottom-nav {
                display: none;
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--mobile-bottom-nav);
            background: var(--card-bg);
            border-top: 1px solid var(--border-color);
            display: flex;
            z-index: 1000;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            color: var(--secondary-color);
            font-size: 11px;
            gap: 4px;
            transition: all 0.2s ease;
            cursor: pointer;
            user-select: none;
        }

        .nav-item.active {
            color: var(--primary-color);
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-icon svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }

        .side-menu {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100vh;
            background: var(--card-bg);
            box-shadow: -2px 0 8px rgba(0,0,0,0.2);
            z-index: 2000;
            transition: right 0.3s ease;
            padding: var(--header-height) 0 0 0;
            overflow-y: auto;
        }

        .side-menu.open {
            right: 0;
        }

        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1500;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .menu-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .mobile-theme-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .mobile-theme-toggle span {
            font-weight: 500;
        }

        .mobile-theme-btn {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--card-bg);
            color: var(--text-color);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .mobile-theme-btn:hover {
            border-color: var(--primary-color);
        }

        .menu-item {
            display: block;
            padding: 16px 20px;
            color: var(--text-color);
            text-decoration: none;
            border-bottom: 1px solid var(--border-color);
            transition: background 0.2s;
            cursor: pointer;
        }

        .menu-item:hover {
            background: var(--bg-color);
        }

        .auth-buttons {
            padding: 20px;
        }

        .auth-btn {
            width: 100%;
            padding: 12px;
            margin-bottom: 12px;
            border: 1px solid var(--primary-color);
            border-radius: 6px;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .auth-btn:hover {
            background: var(--primary-hover);
        }

        .auth-btn.secondary {
            background: transparent;
            color: var(--primary-color);
        }

        .auth-btn.secondary:hover {
            background: rgba(255, 138, 80, 0.1);
        }

        .user-info {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            text-align: center;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin: 0 auto 12px;
        }

        .user-avatar svg {
            width: 30px;
            height: 30px;
            stroke: currentColor;
        }

        .user-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .user-email {
            font-size: 12px;
            color: var(--secondary-color);
        }

        .logout-btn {
            color: #dc3545;
            border-top: 1px solid var(--border-color);
            margin-top: 20px;
        }

        .logout-btn:hover {
            background: rgba(220, 53, 69, 0.1);
        }

        .mobile-lang-select {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .mobile-lang-select select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--card-bg);
            color: var(--text-color);
            font-size: 14px;
        }

        .page-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 0.5rem;
        }

        .page-subtitle {
            color: var(--secondary-color);
            font-size: 1.1rem;
        }

        .sections-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .section-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .section-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            border-color: var(--primary-color);
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-icon {
            font-size: 1.5rem;
        }

        .section-count {
            background: var(--primary-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .section-description {
            color: var(--secondary-color);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .additional-sections {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        .large-section {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .large-section-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .large-section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .large-section-content {
            padding: 1.5rem;
        }

        .donation-projects {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        .donation-card {
            background: linear-gradient(135deg, rgba(255, 138, 80, 0.1) 0%, rgba(255, 112, 67, 0.1) 100%);
            border: 1px solid rgba(255, 138, 80, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .donation-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 138, 80, 0.2);
        }

        .donation-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .donation-poster {
            width: 60px;
            height: 80px;
            border-radius: 6px;
            object-fit: cover;
        }

        .donation-info h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 0.25rem;
        }

        .donation-meta {
            font-size: 0.875rem;
            color: var(--secondary-color);
        }

        .donation-progress {
            margin-bottom: 1rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-hover));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            color: var(--secondary-color);
        }

        .donation-input-group {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .donation-input {
            flex: 1;
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.875rem;
            background: var(--card-bg);
            color: var(--text-color);
        }

        .donate-btn {
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .donate-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 138, 80, 0.3);
        }

        .donation-quick-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .quick-donate-btn {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid var(--primary-color);
            background: transparent;
            color: var(--primary-color);
            border-radius: 6px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-donate-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        .section-detail {
            display: none;
        }

        .section-detail.active {
            display: block;
        }

        .detail-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
        }

        .back-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-color);
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .back-btn:hover {
            border-color: var(--primary-color);
            background-color: rgba(255, 138, 80, 0.05);
        }

        .manga-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1.5rem;
        }

        .manga-card {
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .manga-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .manga-poster-container {
            position: relative;
            aspect-ratio: 3/4;
            overflow: hidden;
        }

        .manga-poster {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .manga-card:hover .manga-poster {
            transform: scale(1.05);
        }

        .manga-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .manga-info {
            padding: 1rem;
        }

        .manga-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 0.5rem;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .manga-meta {
            font-size: 0.8rem;
            color: var(--secondary-color);
            margin-bottom: 0.75rem;
        }

        .manga-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--card-bg);
            color: var(--text-color);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn:hover {
            border-color: var(--primary-color);
            background-color: rgba(255, 138, 80, 0.05);
        }

        .action-btn.primary {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .action-btn.primary:hover {
            background: var(--primary-hover);
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 0.5rem;
        }

        .empty-text {
            color: var(--secondary-color);
            margin-bottom: 1.5rem;
        }

        .empty-action {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: var(--primary-color);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .empty-action:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }

        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #ef4444;
        }

        .notification.warning {
            background: #f59e0b;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            color: var(--secondary-color);
        }

        .spinner {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border-color);
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 12px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .page-title {
                font-size: 1.5rem;
            }

            .sections-grid {
                grid-template-columns: 1fr;
            }

            .manga-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 1rem;
            }

            .donation-projects {
                grid-template-columns: 1fr;
            }

            .mobile-theme-toggle,
            .mobile-lang-select {
                display: flex;
            }

            .side-menu {
                padding-top: 0;
            }
        }

        @media (min-width: 768px) {
            .mobile-theme-toggle,
            .mobile-lang-select {
                display: none;
            }

            .side-menu {
                padding-top: var(--header-height);
            }
        }
    </style>
</head>
<body data-theme="light">
    <!-- ТОЧНО ТАКАЯ ЖЕ СТРУКТУРА КАК В ОРИГИНАЛЕ -->
    <header class="header">
        <a href="index.html" class="logo">Light Fox Manga</a>
        
        <nav class="desktop-nav">
            <a href="index.html" class="nav-link">Главная</a>
            <a href="catalog.html" class="nav-link">Каталог</a>
            <a href="cabinet.html" class="nav-link active">Личный кабинет</a>
            <a href="#" class="nav-link" onclick="openRandomManga()">Случайное</a>
        </nav>
        
        <div class="header-controls">
            <select class="lang-switch" id="langSwitch">
                <option value="ru">Рус</option>
                <option value="ua">Укр</option>
                <option value="en">Eng</option>
            </select>
            <button class="theme-toggle" id="themeToggle">
                <svg class="moon-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79C20.8427 14.4922 20.2039 16.1144 19.1583 17.4668C18.1127 18.8192 16.7035 19.8458 15.0957 20.4265C13.4879 21.0073 11.7431 21.1181 10.0644 20.7461C8.38579 20.374 6.8398 19.5345 5.61677 18.3271C4.39374 17.1198 3.54362 15.5916 3.17133 13.9299C2.79905 12.2682 2.91262 10.5378 3.49644 8.94267C4.08026 7.34753 5.10962 5.94939 6.46482 4.90969C7.82002 3.86999 9.44343 3.23112 11.16 3.08C10.1598 4.98048 9.94059 7.18295 10.5446 9.23931C11.1486 11.2957 12.5154 13.0464 14.3735 14.1467C16.2317 15.247 18.4549 15.6021 20.55 15.13L21 12.79Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <svg class="sun-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: none;">
                    <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 1V3M12 21V23M4.22 4.22L5.64 5.64M18.36 18.36L19.78 19.78M1 12H3M21 12H23M4.22 19.78L5.64 18.36M18.36 5.64L19.78 4.22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <button class="profile-btn" id="profileBtn">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div id="dashboard-view">
                <div class="page-header">
                    <h1 class="page-title">Личный кабинет</h1>
                    <p class="page-subtitle">Управляйте своими тайтлами и поддерживайте любимые серии</p>
                </div>

                <div class="sections-grid">
                    <div class="section-card" onclick="openSection('favorites')">
                        <div class="section-header">
                            <div class="section-title">
                                <span class="section-icon">❤️</span>
                                Избранное
                            </div>
                            <div class="section-count" id="favoritesCount">0</div>
                        </div>
                        <div class="section-description">
                            Ваши любимые тайтлы для быстрого доступа
                        </div>
                    </div>

                    <div class="section-card" onclick="openSection('watching')">
                        <div class="section-header">
                            <div class="section-title">
                                <span class="section-icon">▶️</span>
                                Смотрю
                            </div>
                            <div class="section-count" id="watchingCount">0</div>
                        </div>
                        <div class="section-description">
                            Тайтлы, которые вы сейчас читаете
                        </div>
                    </div>

                    <div class="section-card" onclick="openSection('wantToWatch')">
                        <div class="section-header">
                            <div class="section-title">
                                <span class="section-icon">📚</span>
                                Хочу посмотреть
                            </div>
                            <div class="section-count" id="wantToWatchCount">0</div>
                        </div>
                        <div class="section-description">
                            Запланированные к просмотру тайтлы
                        </div>
                    </div>

                    <div class="section-card" onclick="openSection('completed')">
                        <div class="section-header">
                            <div class="section-title">
                                <span class="section-icon">✅</span>
                                Досмотрел
                            </div>
                            <div class="section-count" id="completedCount">0</div>
                        </div>
                        <div class="section-description">
                            Завершенные тайтлы
                        </div>
                    </div>
                </div>

                <div class="additional-sections">
                    <div class="large-section">
                        <div class="large-section-header">
                            <div class="large-section-title">
                                <span>🚀</span>
                                Поддержать проекты
                            </div>
                        </div>
                        <div class="large-section-content">
                            <div id="donationProjectsContainer">
                                <div class="loading">
                                    <div class="spinner"></div>
                                    Загрузка проектов...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="section-detail" class="section-detail">
                <div class="detail-header">
                    <button class="back-btn" onclick="backToDashboard()">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                        Назад
                    </button>
                    <h2 id="sectionTitle">Раздел</h2>
                </div>

                <div id="sectionContent">
                    <!-- Content will be filled by JavaScript -->
                </div>
            </div>
        </div>
    </main>

    <nav class="bottom-nav">
        <a href="index.html" class="nav-item">
            <div class="nav-icon">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 12L5 10M5 10L12 3L19 10M5 10V20C5 20.5523 5.44772 21 6 21H9M19 10L21 12M19 10V20C19 20.5523 18.5523 21 18 21H15M9 21C9.55228 21 10 20.5523 10 20V16C10 15.4477 10.4477 15 11 15H13C13.5523 15 14 15.4477 14 16V20C14 20.5523 14.4477 21 15 21M9 21H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <span>Главная</span>
        </a>
        <a href="catalog.html" class="nav-item">
            <div class="nav-icon">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 19.5C4 18.1193 5.11929 17 6.5 17H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M6.5 2H20V22H6.5C5.11929 22 4 20.8807 4 19.5V4.5C4 3.11929 5.11929 2 6.5 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <span>Каталог</span>
        </a>
        <a href="cabinet.html" class="nav-item active">
            <div class="nav-icon">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20.84 4.61C20.3292 4.099 19.7228 3.69364 19.0554 3.41708C18.3879 3.14052 17.6725 2.99817 16.95 2.99817C16.2275 2.99817 15.5121 3.14052 14.8446 3.41708C14.1772 3.69364 13.5708 4.099 13.06 4.61L12 5.67L10.94 4.61C9.9083 3.5783 8.50903 2.9987 7.05 2.9987C5.59096 2.9987 4.19169 3.5783 3.16 4.61C2.1283 5.6417 1.5487 7.04097 1.5487 8.5C1.5487 9.95903 2.1283 11.3583 3.16 12.39L4.22 13.45L12 21.23L19.78 13.45L20.84 12.39C21.351 11.8792 21.7563 11.2728 22.0329 10.6053C22.3095 9.93789 22.4518 9.22248 22.4518 8.5C22.4518 7.77752 22.3095 7.06211 22.0329 6.39467C21.7563 5.72723 21.351 5.1208 20.84 4.61Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <span>Кабинет</span>
        </a>
        <a href="#" class="nav-item" onclick="openRandomManga()">
            <div class="nav-icon">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 8C18 6.4087 17.3679 4.88258 16.2426 3.75736C15.1174 2.63214 13.5913 2 12 2C10.4087 2 8.88258 2.63214 7.75736 3.75736C6.63214 4.88258 6 6.4087 6 8C6 15 3 17 3 17H21C21 17 18 15 18 8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M13.73 21C13.5542 21.3031 13.3019 21.5547 12.9982 21.7295C12.6946 21.9044 12.3504 21.9965 12 21.9965C11.6496 21.9965 11.3054 21.9044 11.0018 21.7295C10.6982 21.5547 10.4458 21.3031 10.27 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <span>Случайное</span>
        </a>
        <div class="nav-item" id="mobileProfileBtn">
            <div class="nav-icon">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <span>Профиль</span>
        </div>
    </nav>

    <div class="menu-overlay" id="menuOverlay"></div>

    <div class="side-menu" id="sideMenu">
        <div class="auth-buttons" id="authSection">
            <button class="auth-btn" onclick="login()">Вход/Регистрация</button>
        </div>

        <div class="user-info" id="userSection" style="display: none;">
            <div class="user-avatar" id="userAvatar">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <div class="user-name" id="userName">Пользователь</div>
            <div class="user-email" id="userEmail">user@example.com</div>
        </div>

        <div class="mobile-theme-toggle">
            <span>Темная тема</span>
            <button class="mobile-theme-btn" id="mobileThemeToggle">
                <svg class="mobile-moon-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79C20.8427 14.4922 20.2039 16.1144 19.1583 17.4668C18.1127 18.8192 16.7035 19.8458 15.0957 20.4265C13.4879 21.0073 11.7431 21.1181 10.0644 20.7461C8.38579 20.374 6.8398 19.5345 5.61677 18.3271C4.39374 17.1198 3.54362 15.5916 3.17133 13.9299C2.79905 12.2682 2.91262 10.5378 3.49644 8.94267C4.08026 7.34753 5.10962 5.94939 6.46482 4.90969C7.82002 3.86999 9.44343 3.23112 11.16 3.08C10.1598 4.98048 9.94059 7.18295 10.5446 9.23931C11.1486 11.2957 12.5154 13.0464 14.3735 14.1467C16.2317 15.247 18.4549 15.6021 20.55 15.13L21 12.79Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <svg class="mobile-sun-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: none;">
                    <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 1V3M12 21V23M4.22 4.22L5.64 5.64M18.36 18.36L19.78 19.78M1 12H3M21 12H23M4.22 19.78L5.64 18.36M18.36 5.64L19.78 4.22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>

        <div class="mobile-lang-select">
            <select id="mobileLangSwitch">
                <option value="ru">Русский</option>
                <option value="ua">Українська</option>
                <option value="en">English</option>
            </select>
        </div>

        <a href="index.html" class="menu-item">Главная</a>
        <a href="cabinet.html" class="menu-item">Личный Кабинет</a>
        <a href="catalog.html" class="menu-item">Каталог</a>
        <a href="#" class="menu-item" onclick="openRandomManga(); closeMenu();">Случайная Манга</a>
        <a href="cabinet.html#favorites" class="menu-item">Избранное</a>
        <a href="cabinet.html#history" class="menu-item">История</a>
        <a href="cabinet.html#settings" class="menu-item">Настройки</a>
        
        <a href="#" class="menu-item logout-btn" id="logoutBtn" onclick="logout()" style="display: none;">Выйти</a>
    </div>

    <div class="notification" id="notification"></div>

    <!-- ИНТЕГРИРОВАННАЯ СИСТЕМА СКРИПТОВ -->
    <script>
        // State
        let isDark = localStorage.getItem('theme') === 'dark';
        let isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        let currentSection = null;
        let userLists = {
            favorites: [],
            watching: [],
            wantToWatch: [],
            completed: []
        };

        // === БЕЗОПАСНАЯ ЗАГРУЗКА ДАННЫХ ===
        function loadDataSystemSafely() {
            return new Promise((resolve) => {
                const script = document.createElement('script');
                script.src = 'js/data.js';
                
                let isResolved = false;
                const timeout = setTimeout(() => {
                    if (!isResolved) {
                        console.warn('⏰ Таймаут загрузки data.js, создаю fallback');
                        createMockMangaAPI();
                        isResolved = true;
                        resolve(false);
                    }
                }, 3000);

                script.onload = () => {
                    if (!isResolved) {
                        clearTimeout(timeout);
                        console.log('✅ data.js загружен успешно');
                        
                        setTimeout(() => {
                            if (window.MangaAPI && typeof window.MangaAPI.getAllManga === 'function') {
                                console.log('🎯 MangaAPI готов к использованию');
                                isResolved = true;
                                resolve(true);
                            } else {
                                console.warn('⚠️ MangaAPI не готов, создаю fallback');
                                createMockMangaAPI();
                                isResolved = true;
                                resolve(false);
                            }
                        }, 100);
                    }
                };

                script.onerror = () => {
                    if (!isResolved) {
                        clearTimeout(timeout);
                        console.warn('❌ Ошибка загрузки data.js, создаю fallback');
                        createMockMangaAPI();
                        isResolved = true;
                        resolve(false);
                    }
                };

                document.head.appendChild(script);
            });
        }

        // === СОЗДАНИЕ СОВМЕСТИМОГО MOCK API ===
        function createMockMangaAPI() {
            console.log('🔧 Создание совместимого Mock API...');
            
            const mockData = [
                {
                    id: '1',
                    title: 'Атака титанов',
                    type: 'Аниме',
                    status: 'Завершён',
                    year: 2013,
                    rating: 9.0,
                    genres: ['Экшен', 'Драма', 'Фэнтези', 'Военное'],
                    categories: ['Сёнен'],
                    availableEpisodes: 87,
                    totalEpisodes: 87,
                    currentDonations: 7500,
                    donationGoal: 10000,
                    image: 'https://via.placeholder.com/300x450/FF6B35/FFFFFF?text=АТ',
                    description: 'Человечество живёт в городах, окружённых огромными стенами, защищающими от титанов.',
                    episodes: {
                        1: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                        2: 'https://www.youtube.com/embed/dQw4w9WgXcQ'
                    }
                },
                {
                    id: '2',
                    title: 'Наруто',
                    type: 'Аниме',
                    status: 'Завершён',
                    year: 2002,
                    rating: 8.7,
                    genres: ['Экшен', 'Приключения', 'Боевые искусства'],
                    categories: ['Сёнен'],
                    availableEpisodes: 720,
                    totalEpisodes: 720,
                    currentDonations: 12000,
                    donationGoal: 15000,
                    image: 'https://via.placeholder.com/300x450/4A90E2/FFFFFF?text=Н',
                    description: 'История молодого ниндзя Наруто Узумаки.',
                    episodes: {
                        1: 'https://www.youtube.com/embed/dQw4w9WgXcQ'
                    }
                }
            ];

            window.MangaAPI = {
                getAllManga: () => [...mockData],
                getMangaById: (id) => mockData.find(manga => manga.id === String(id)),
                addManga: (manga) => {
                    const newManga = {
                        id: String(Date.now()),
                        currentDonations: 0,
                        donationGoal: 10000,
                        episodes: {},
                        ...manga
                    };
                    mockData.push(newManga);
                    return newManga;
                },
                updateManga: (id, updates) => {
                    const index = mockData.findIndex(manga => manga.id === String(id));
                    if (index !== -1) {
                        mockData[index] = { ...mockData[index], ...updates };
                        try {
                            localStorage.setItem('lightfox_manga_data', JSON.stringify(mockData));
                        } catch (e) {
                            console.warn('Не удалось сохранить данные:', e);
                        }
                        return mockData[index];
                    }
                    return null;
                },
                deleteManga: (id) => {
                    const index = mockData.findIndex(manga => manga.id === String(id));
                    if (index !== -1) {
                        return mockData.splice(index, 1)[0];
                    }
                    return null;
                },
                getStats: () => ({
                    totalManga: mockData.length,
                    totalEpisodes: mockData.reduce((sum, manga) => sum + (manga.availableEpisodes || 0), 0),
                    averageRating: mockData.reduce((sum, manga) => sum + (manga.rating || 0), 0) / mockData.length,
                    totalDonations: mockData.reduce((sum, manga) => sum + (manga.currentDonations || 0), 0)
                }),
                isReady: true,
                _isMock: true
            };

            console.log('✅ Mock MangaAPI создан и готов к использованию');
            
            setTimeout(() => {
                if (typeof window !== 'undefined') {
                    window.dispatchEvent(new CustomEvent('mangaDataReady', {
                        detail: { api: window.MangaAPI }
                    }));
                }
            }, 100);
        }

        // Theme functionality
        function updateTheme() {
            document.body.setAttribute('data-theme', isDark ? 'dark' : 'light');
            
            const updateIcons = (moonClass, sunClass) => {
                const moonIcons = document.querySelectorAll(moonClass);
                const sunIcons = document.querySelectorAll(sunClass);
                
                moonIcons.forEach(icon => {
                    icon.style.display = isDark ? 'none' : 'block';
                });
                
                sunIcons.forEach(icon => {
                    icon.style.display = isDark ? 'block' : 'none';
                });
            };
            
            updateIcons('.moon-icon', '.sun-icon');
            updateIcons('.mobile-moon-icon', '.mobile-sun-icon');
            
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        function toggleTheme() {
            isDark = !isDark;
            updateTheme();
        }

        // Language functionality
        function updateLanguage(lang) {
            localStorage.setItem('language', lang);
            
            const langSwitch = document.getElementById('langSwitch');
            const mobileLangSwitch = document.getElementById('mobileLangSwitch');
            
            if (langSwitch) langSwitch.value = lang;
            if (mobileLangSwitch) mobileLangSwitch.value = lang;
        }

        // Authentication functionality
        function updateAuthState() {
            const authSection = document.getElementById('authSection');
            const userSection = document.getElementById('userSection');
            const logoutBtn = document.getElementById('logoutBtn');
            
            if (isLoggedIn && currentUser) {
                authSection.style.display = 'none';
                userSection.style.display = 'block';
                logoutBtn.style.display = 'block';
                
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userEmail').textContent = currentUser.email;
            } else {
                authSection.style.display = 'block';
                userSection.style.display = 'none';
                logoutBtn.style.display = 'none';
            }
        }

        function login() {
            const name = prompt('Введите ваше имя:') || 'Пользователь';
            const email = prompt('Введите ваш email:') || 'user@example.com';
            
            if (name && email) {
                currentUser = { name, email };
                isLoggedIn = true;
                
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                updateAuthState();
                closeMenu();
                
                showNotification(`Добро пожаловать, ${name}!`, 'success');
            }
        }

        function logout() {
            if (confirm('Вы уверены, что хотите выйти?')) {
                isLoggedIn = false;
                currentUser = null;
                
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('currentUser');
                
                updateAuthState();
                closeMenu();
                
                showNotification('Вы успешно вышли из системы', 'success');
            }
        }

        // Menu functionality
        function toggleMenu() {
            const sideMenu = document.getElementById('sideMenu');
            const menuOverlay = document.getElementById('menuOverlay');
            
            sideMenu.classList.toggle('open');
            menuOverlay.classList.toggle('show');
        }

        function closeMenu() {
            const sideMenu = document.getElementById('sideMenu');
            const menuOverlay = document.getElementById('menuOverlay');
            
            sideMenu.classList.remove('open');
            menuOverlay.classList.remove('show');
        }

        // Random manga functionality
        function openRandomManga() {
            if (window.MangaAPI) {
                const allManga = window.MangaAPI.getAllManga();
                if (allManga.length > 0) {
                    const randomManga = allManga[Math.floor(Math.random() * allManga.length)];
                    window.location.href = `player.html?id=${randomManga.id}`;
                } else {
                    showNotification('Каталог пуст', 'error');
                }
            } else {
                showNotification('Система данных не загружена', 'error');
            }
        }

        // === УЛУЧШЕННАЯ ИНИЦИАЛИЗАЦИЯ КАБИНЕТА ===
        async function initializeCabinet() {
            console.log('🚀 Инициализация личного кабинета...');
            
            try {
                const dataLoaded = await loadDataSystemSafely();
                
                if (!window.MangaAPI) {
                    console.error('❌ MangaAPI недоступен даже после fallback');
                    showNotification('Критическая ошибка системы данных', 'error');
                    return;
                }

                console.log(`✅ Система данных готова (${window.MangaAPI._isMock ? 'Mock' : 'Real'} API)`);
                
                const testManga = window.MangaAPI.getAllManga();
                console.log(`📚 Доступно ${testManga.length} тайтлов`);

                loadUserLists();
                updateCounts();
                loadDonationProjects();
                
                console.log('✅ Личный кабинет полностью инициализирован');
                
            } catch (error) {
                console.error('❌ Критическая ошибка инициализации:', error);
                showNotification('Ошибка загрузки системы', 'error');
            }
        }

        // Load user lists from localStorage
        function loadUserLists() {
            Object.keys(userLists).forEach(listName => {
                const saved = localStorage.getItem(listName);
                if (saved) {
                    try {
                        userLists[listName] = JSON.parse(saved);
                    } catch (e) {
                        console.error(`Error loading ${listName}:`, e);
                        userLists[listName] = [];
                    }
                }
            });
        }

        // Update section counts
        function updateCounts() {
            Object.keys(userLists).forEach(listName => {
                const countElement = document.getElementById(listName + 'Count');
                if (countElement) {
                    countElement.textContent = userLists[listName].length;
                }
            });
        }

        // === ИСПРАВЛЕННАЯ ЗАГРУЗКА ПРОЕКТОВ ДОНАТОВ ===
        function loadDonationProjects() {
            console.log('🚀 Запуск loadDonationProjects...');
            
            const container = document.getElementById('donationProjectsContainer');
            if (!container) {
                console.error('❌ Контейнер donationProjectsContainer не найден');
                return;
            }

            if (!window.MangaAPI) {
                console.warn('⚠️ MangaAPI недоступен, показываем загрузку...');
                container.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        Система данных загружается...
                    </div>
                `;
                return;
            }

            try {
                // ЧИТАЕМ ДОНАТ-ПРОЕКТЫ ИЗ АДМИНКИ
                const donationProjects = JSON.parse(localStorage.getItem('lightfox_donation_projects') || '[]');
                console.log(`💰 Найдено ${donationProjects.length} донат-проектов из админки`);

                if (donationProjects.length === 0) {
                    // Fallback: используем старую систему из MangaAPI
                    return loadDonationProjectsFromAPI();
                }

                // Фильтруем только активные проекты с прогрессом < 100%
                const activeProjects = donationProjects.filter(project => {
                    if (project.status !== 'active') return false;
                    
                    const progress = (project.currentAmount / project.goal) * 100;
                    const needsDonation = progress < 100;
                    
                    if (needsDonation) {
                        console.log(`💰 Активный проект "${project.title}": ${project.currentAmount}/${project.goal} (${progress.toFixed(1)}%)`);
                    }
                    
                    return needsDonation;
                }).slice(0, 6); // Максимум 6 проектов

                console.log(`✅ Отобрано ${activeProjects.length} активных проектов для отображения`);

                if (activeProjects.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">🎉</div>
                            <div class="empty-title">Все цели достигнуты!</div>
                            <div class="empty-text">Спасибо за поддержку проектов</div>
                        </div>
                    `;
                    return;
                }

                // Генерируем HTML для проектов
                const projectsHTML = activeProjects.map(project => {
                    console.log(`🎨 Создаю карточку для проекта "${project.title}"`);
                    return renderDonationProjectCard(project);
                }).join('');

                container.innerHTML = `
                    <div class="donation-projects">
                        ${projectsHTML}
                    </div>
                `;

                console.log('✅ Донат-проекты из админки загружены успешно');

            } catch (error) {
                console.error('❌ Критическая ошибка в loadDonationProjects:', error);
                // Fallback на старую систему
                loadDonationProjectsFromAPI();
            }
        }

        // Fallback функция для совместимости со старой системой
        function loadDonationProjectsFromAPI() {
            console.log('🔄 Использую fallback: загрузка через MangaAPI');
            
            const container = document.getElementById('donationProjectsContainer');
            const allManga = window.MangaAPI.getAllManga();

            if (!allManga || allManga.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">📚</div>
                        <div class="empty-title">Пока нет проектов</div>
                        <div class="empty-text">Тайтлы для поддержки появятся здесь</div>
                        <a href="catalog.html" class="empty-action">
                            <span>🔍</span>
                            Открыть каталог
                        </a>
                    </div>
                `;
                return;
            }

            // Фильтруем манга с неполными донатами
            const activeProjects = allManga.filter(manga => {
                const current = manga.currentDonations || 0;
                const goal = manga.donationGoal || 10000;
                const progress = (current / goal) * 100;
                return progress < 100;
            }).slice(0, 6);

            if (activeProjects.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">🎉</div>
                        <div class="empty-title">Все цели достигнуты!</div>
                        <div class="empty-text">Спасибо за поддержку проектов</div>
                    </div>
                `;
                return;
            }

            const projectsHTML = activeProjects.map(manga => renderDonationCard(manga)).join('');
            container.innerHTML = `
                <div class="donation-projects">
                    ${projectsHTML}
                </div>
            `;
        }

        // Рендер карточки донат-проекта (из админки)
        function renderDonationProjectCard(project) {
            if (!project) {
                console.error('❌ Попытка рендера пустого проекта');
                return '';
            }

            // Получаем данные манги для дополнительной информации
            const manga = window.MangaAPI ? window.MangaAPI.getMangaById(project.mangaId) : null;
            
            const progress = Math.min((project.currentAmount / project.goal) * 100, 100);
            const title = project.title || 'Неизвестный проект';
            const mangaTitle = manga ? manga.title : 'Неизвестная манга';
            const type = manga ? manga.type : 'Проект';
            const year = manga ? manga.year : '';
            
            // Приоритет изображений: проект > манга > placeholder
            const image = project.image || 
                         (manga ? manga.image : null) || 
                         `https://via.placeholder.com/60x80/8b5cf6/FFFFFF?text=${encodeURIComponent(title.charAt(0))}`;

            return `
                <div class="donation-card">
                    <div class="donation-header">
                        <img src="${image}" 
                             alt="${title}" 
                             class="donation-poster"
                             onerror="this.src='https://via.placeholder.com/60x80/8b5cf6/FFFFFF?text=${encodeURIComponent(title.charAt(0))}'">
                        <div class="donation-info">
                            <h3>${title}</h3>
                            <div class="donation-meta">${type}${year ? ` • ${year}` : ''}</div>
                            ${project.description ? `<div style="font-size: 0.75rem; color: var(--secondary-color); margin-top: 4px;">${project.description}</div>` : ''}
                        </div>
                    </div>
                    
                    <div class="donation-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                        <div class="progress-text">
                            <span>${project.currentAmount.toLocaleString()}₽</span>
                            <span>${project.goal.toLocaleString()}₽</span>
                        </div>
                    </div>

                    <div class="donation-input-group">
                        <input type="number" class="donation-input" 
                               placeholder="Сумма" min="10" max="50000" 
                               id="donationAmountProject${project.id}">
                        <button class="donate-btn" onclick="makeDonationToProject(${project.id})">💝 Донат</button>
                    </div>

                    <div class="donation-quick-buttons">
                        <button class="quick-donate-btn" onclick="quickDonateToProject(${project.id}, 100)">100₽</button>
                        <button class="quick-donate-btn" onclick="quickDonateToProject(${project.id}, 500)">500₽</button>
                        <button class="quick-donate-btn" onclick="quickDonateToProject(${project.id}, 1000)">1K₽</button>
                    </div>
                </div>
            `;
        }

        // Рендер карточки манги (старая система)
        function renderDonationCard(manga) {
            if (!manga) return '';

            const current = manga.currentDonations || 0;
            const goal = manga.donationGoal || 10000;
            const progress = Math.min((current / goal) * 100, 100);
            const title = manga.title || 'Неизвестный тайтл';
            const type = manga.type || 'Манга';
            const year = manga.year || 'N/A';
            const image = manga.image || `https://via.placeholder.com/60x80/FF6B35/FFFFFF?text=${encodeURIComponent(title.charAt(0))}`;

            return `
                <div class="donation-card">
                    <div class="donation-header">
                        <img src="${image}" 
                             alt="${title}" 
                             class="donation-poster"
                             onerror="this.src='https://via.placeholder.com/60x80/FF6B35/FFFFFF?text=${encodeURIComponent(title.charAt(0))}'">
                        <div class="donation-info">
                            <h3>${title}</h3>
                            <div class="donation-meta">${type} • ${year}</div>
                        </div>
                    </div>
                    
                    <div class="donation-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                        <div class="progress-text">
                            <span>${current.toLocaleString()}₽</span>
                            <span>${goal.toLocaleString()}₽</span>
                        </div>
                    </div>

                    <div class="donation-input-group">
                        <input type="number" class="donation-input" 
                               placeholder="Сумма" min="10" max="50000" 
                               id="donationAmount${manga.id}">
                        <button class="donate-btn" onclick="makeDonation('${manga.id}')">💝 Донат</button>
                    </div>

                    <div class="donation-quick-buttons">
                        <button class="quick-donate-btn" onclick="quickDonate('${manga.id}', 100)">100₽</button>
                        <button class="quick-donate-btn" onclick="quickDonate('${manga.id}', 500)">500₽</button>
                        <button class="quick-donate-btn" onclick="quickDonate('${manga.id}', 1000)">1K₽</button>
                    </div>
                </div>
            `;
        }

        // Функции для донатов в проекты (новая система)
        function quickDonateToProject(projectId, amount) {
            const input = document.getElementById(`donationAmountProject${projectId}`);
            if (input) {
                input.value = amount;
                makeDonationToProject(projectId);
            }
        }

        function makeDonationToProject(projectId) {
            const amountInput = document.getElementById(`donationAmountProject${projectId}`);
            const amount = parseInt(amountInput.value) || 0;

            if (amount < 10) {
                showNotification('Минимальная сумма: 10₽', 'error');
                return;
            }

            if (amount > 50000) {
                showNotification('Максимальная сумма: 50,000₽', 'error');
                return;
            }

            try {
                // Загружаем донат-проекты
                const donationProjects = JSON.parse(localStorage.getItem('lightfox_donation_projects') || '[]');
                const projectIndex = donationProjects.findIndex(p => p.id === projectId);
                
                if (projectIndex === -1) {
                    showNotification('Проект не найден', 'error');
                    return;
                }

                const project = donationProjects[projectIndex];
                
                // Обновляем сумму
                const newTotal = Math.min(project.currentAmount + amount, project.goal);
                donationProjects[projectIndex].currentAmount = newTotal;
                donationProjects[projectIndex].updatedAt = new Date().toISOString();
                
                // Сохраняем обновленные проекты
                localStorage.setItem('lightfox_donation_projects', JSON.stringify(donationProjects));
                
                // Сохраняем историю донатов
                const donationHistory = JSON.parse(localStorage.getItem('donationHistory') || '[]');
                donationHistory.push({
                    projectId: projectId,
                    projectTitle: project.title,
                    mangaId: project.mangaId,
                    amount: amount,
                    timestamp: new Date().toISOString()
                });
                localStorage.setItem('donationHistory', JSON.stringify(donationHistory));

                // Очищаем поле ввода
                amountInput.value = '';

                // Перезагружаем проекты
                loadDonationProjects();

                showNotification(`Спасибо! Добавлено ${amount.toLocaleString()}₽ в "${project.title}"`, 'success');
                
                // Уведомляем о обновлении
                window.dispatchEvent(new CustomEvent('donationUpdate', {
                    detail: { projectId, newAmount: newTotal }
                }));

            } catch (error) {
                console.error('❌ Ошибка при донате в проект:', error);
                showNotification('Ошибка обработки доната', 'error');
            }
        }

        // Функции для донатов в манга (старая система)
        function quickDonate(mangaId, amount) {
            const input = document.getElementById(`donationAmount${mangaId}`);
            if (input) {
                input.value = amount;
                makeDonation(mangaId);
            }
        }

        function makeDonation(mangaId) {
            const amountInput = document.getElementById(`donationAmount${mangaId}`);
            const amount = parseInt(amountInput.value) || 0;

            if (amount < 10) {
                showNotification('Минимальная сумма: 10₽', 'error');
                return;
            }

            if (amount > 50000) {
                showNotification('Максимальная сумма: 50,000₽', 'error');
                return;
            }

            if (window.MangaAPI) {
                const manga = window.MangaAPI.getMangaById(mangaId);
                if (manga) {
                    const newTotal = Math.min((manga.currentDonations || 0) + amount, manga.donationGoal || 10000);
                    
                    const updated = window.MangaAPI.updateManga(mangaId, {
                        currentDonations: newTotal
                    });

                    if (updated) {
                        const donationHistory = JSON.parse(localStorage.getItem('donationHistory') || '[]');
                        donationHistory.push({
                            mangaId: mangaId,
                            mangaTitle: manga.title,
                            amount: amount,
                            timestamp: new Date().toISOString()
                        });
                        localStorage.setItem('donationHistory', JSON.stringify(donationHistory));

                        amountInput.value = '';
                        loadDonationProjects();

                        showNotification(`Спасибо! Добавлено ${amount.toLocaleString()}₽`, 'success');
                        
                        window.dispatchEvent(new CustomEvent('mangaDataUpdate', {
                            detail: { mangaId, newDonations: newTotal }
                        }));
                    } else {
                        showNotification('Ошибка обновления', 'error');
                    }
                } else {
                    showNotification('Тайтл не найден', 'error');
                }
            } else {
                showNotification('API недоступен', 'error');
            }
        }

        // Section navigation
        function openSection(sectionName) {
            currentSection = sectionName;
            
            document.getElementById('dashboard-view').style.display = 'none';
            document.getElementById('section-detail').classList.add('active');
            
            const titles = {
                favorites: 'Избранное',
                watching: 'Смотрю',
                wantToWatch: 'Хочу посмотреть',
                completed: 'Досмотрел'
            };
            document.getElementById('sectionTitle').textContent = titles[sectionName] || sectionName;
            
            loadSectionContent(sectionName);
        }

        function backToDashboard() {
            document.getElementById('dashboard-view').style.display = 'block';
            document.getElementById('section-detail').classList.remove('active');
            currentSection = null;
        }

        // Load section content
        function loadSectionContent(sectionName) {
            const container = document.getElementById('sectionContent');
            const items = userLists[sectionName] || [];

            if (items.length === 0) {
                const emptyStates = {
                    favorites: {
                        icon: '❤️',
                        title: 'Нет избранных тайтлов',
                        text: 'Добавляйте тайтлы в избранное из каталога или плеера'
                    },
                    watching: {
                        icon: '▶️',
                        title: 'Не читаете тайтлы',
                        text: 'Начните читать тайтлы и они появятся здесь'
                    },
                    wantToWatch: {
                        icon: '📚',
                        title: 'Список пуст',
                        text: 'Добавляйте интересные тайтлы в планы'
                    },
                    completed: {
                        icon: '✅',
                        title: 'Нет завершенных',
                        text: 'Прочитанные тайтлы будут отображаться здесь'
                    }
                };

                const state = emptyStates[sectionName];
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">${state.icon}</div>
                        <div class="empty-title">${state.title}</div>
                        <div class="empty-text">${state.text}</div>
                        <a href="catalog.html" class="empty-action">
                            <span>🔍</span>
                            Открыть каталог
                        </a>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="manga-grid">
                    ${items.map(item => renderMangaCard(item)).join('')}
                </div>
            `;
        }

        // Render manga card for lists
        function renderMangaCard(item) {
            let manga = item;
            if (window.MangaAPI && item.mangaId) {
                const apiData = window.MangaAPI.getMangaById(item.mangaId);
                if (apiData) {
                    manga = { ...item, ...apiData };
                }
            }

            return `
                <div class="manga-card" onclick="openManga(${manga.mangaId || manga.id})">
                    <div class="manga-poster-container">
                        <img src="${manga.image || 'https://via.placeholder.com/180x240/FF6B35/FFFFFF?text=' + encodeURIComponent((manga.title || '').charAt(0))}" 
                             alt="${manga.title}" class="manga-poster">
                        ${manga.currentEpisode ? `<div class="manga-badge">Серия ${manga.currentEpisode}</div>` : ''}
                    </div>
                    
                    <div class="manga-info">
                        <div class="manga-title">${manga.title}</div>
                        <div class="manga-meta">
                            ${manga.type || 'Манга'} • ⭐ ${manga.rating || 'N/A'}
                        </div>
                        
                        <div class="manga-actions">
                            <button class="action-btn primary" onclick="event.stopPropagation(); openManga(${manga.mangaId || manga.id})">
                                Читать
                            </button>
                            <button class="action-btn" onclick="event.stopPropagation(); removeFromList('${currentSection}', ${item.id || item.mangaId})">
                                Удалить
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // User actions
        function openManga(mangaId) {
            if (mangaId && mangaId !== 'undefined') {
                window.location.href = `player.html?id=${mangaId}`;
            } else {
                showNotification('Тайтл не найден', 'error');
            }
        }

        function removeFromList(listName, itemId) {
            const list = userLists[listName];
            const index = list.findIndex(item => (item.id || item.mangaId) === itemId);
            
            if (index !== -1) {
                list.splice(index, 1);
                localStorage.setItem(listName, JSON.stringify(list));
                updateCounts();
                
                if (currentSection === listName) {
                    loadSectionContent(listName);
                }
                
                showNotification('Удалено из списка', 'success');
            }
        }

        // Utility functions
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification show ${type}`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // === ИНИЦИАЛИЗАЦИЯ И ОБРАБОТЧИКИ СОБЫТИЙ ===
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎯 DOM загружен, начинаем инициализацию...');
            
            // Theme toggles
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            document.getElementById('mobileThemeToggle').addEventListener('click', toggleTheme);

            // Language switches
            const langSwitch = document.getElementById('langSwitch');
            const mobileLangSwitch = document.getElementById('mobileLangSwitch');
            
            if (langSwitch) {
                langSwitch.addEventListener('change', (e) => updateLanguage(e.target.value));
            }
            if (mobileLangSwitch) {
                mobileLangSwitch.addEventListener('change', (e) => updateLanguage(e.target.value));
            }

            // Profile buttons
            document.getElementById('profileBtn').addEventListener('click', toggleMenu);
            document.getElementById('mobileProfileBtn').addEventListener('click', (e) => {
                e.preventDefault();
                toggleMenu();
            });

            // Menu overlay
            document.getElementById('menuOverlay').addEventListener('click', closeMenu);

            // Initialize
            updateTheme();
            updateAuthState();
            
            // Load saved language
            const savedLang = localStorage.getItem('language') || 'ru';
            updateLanguage(savedLang);

            // Запускаем инициализацию кабинета
            initializeCabinet();

            // Listen for storage updates from other pages
            window.addEventListener('storage', function(e) {
                if (['favorites', 'watching', 'wantToWatch', 'completed'].includes(e.key)) {
                    loadUserLists();
                    updateCounts();
                    if (currentSection) {
                        loadSectionContent(currentSection);
                    }
                }
            });
        });

        // Listen for data ready event
        window.addEventListener('mangaDataReady', function(e) {
            console.log('📡 Получено событие mangaDataReady');
            loadDonationProjects();
        });

        window.addEventListener('mangaDataUpdate', function(e) {
            console.log('📡 Получено событие mangaDataUpdate');
            loadDonationProjects();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeMenu();
            }
        });

        // Экспорт функций для onclick
        window.openSection = openSection;
        window.backToDashboard = backToDashboard;
        window.openManga = openManga;
        window.removeFromList = removeFromList;
        window.makeDonation = makeDonation;
        window.quickDonate = quickDonate;
        window.makeDonationToProject = makeDonationToProject;
        window.quickDonateToProject = quickDonateToProject;
        window.openRandomManga = openRandomManga;
        window.login = login;
        window.logout = logout;
        window.closeMenu = closeMenu;

        console.log('🎉 Исправленный личный кабинет с поддержкой донат-проектов готов!');
    </script>
</body>
</html>
